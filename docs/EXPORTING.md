# การส่งออกรายงาน

การส่งออกรายงานประจำเดือนมีให้ใช้งานผ่าน `ExportService`
ซึ่งจะสร้างไฟล์ PDF หรือ Excel ชั่วคราวแล้วคืนค่า `Path`
ของไฟล์ที่สร้างขึ้น ตัวอย่างเช่น

```python
from pathlib import Path
from src.services import ExportService, StorageService

storage = StorageService(Path("db.sqlite"))
service = ExportService(storage)

pdf_file = service.export_monthly_pdf("2024-05", None)
xlsx_file = service.export_monthly_xlsx("2024-05")
```

เมทอด `export_monthly_xlsx` ต้องติดตั้งไลบรารี `openpyxl`
เพื่อเขียนไฟล์ Excel

หากต้องการส่งออกเป็น CSV ยังคงใช้เมทอด `Exporter.monthly_csv`
โดยระบุเดือน ปี และ `Path` ปลายทางเหมือนเดิม

รายงานทั้งสองรูปแบบจะมีคอลัมน์ต่อไปนี้

- `date`
- `fuel_type`
- `odo_before`
- `odo_after`
- `distance`
- `liters`
- `amount_spent`

## รูปแบบไฟล์ PDF

ไฟล์ PDF ที่สร้างประกอบด้วยสามหน้าได้แก่

1. **สรุปประจำเดือน** – แสดงผลรวมระยะทาง ปริมาณเชื้อเพลิง และอัตราสิ้นเปลือง (km/L)
   พร้อมกราฟแกนคู่ที่แสดงปริมาณลิตรต่อวัน (แท่ง) เทียบกับอัตราสิ้นเปลืองต่อวัน (เส้น)
2. **รายสัปดาห์** – ตารางสรุปลิตรเชื้อเพลิงแยกตามวัน (จ.-อา.) ภายในแต่ละสัปดาห์ ISO
   และกราฟแท่งปริมาณเชื้อเพลิงรายวัน
3. **เปรียบเทียบยานพาหนะ** – กราฟแท่งปริมาณลิตรเทียบกับกราฟเส้น km/L ของแต่ละยานพาหนะ
   จัดเรียงตามอัตราสิ้นเปลืองมากไปน้อย

เมื่อส่งออกเฉพาะยานพาหนะ รายงานจะระบุชื่อยานพาหนะไว้ในหัวเรื่องเพื่อให้อ่านง่าย

แบบอักษรที่ใช้คือ `NotoSansThai` ซึ่งค้นหาผ่าน `matplotlib.font_manager.findfont`.
หากไม่พบแบบอักษรนี้ โปรแกรมจะใช้ `Tahoma` หรือแบบอักษร sans-serif
ทั่วไปแทน

## รูปแบบไฟล์ Excel

ไฟล์ Excel แบ่งเป็นสามชีต

1. **Entries** - บันทึกข้อมูลการเติมเชื้อเพลิงรายแถว รวมคอลัมน์ `date`, `fuel_type`,
   `odo_before`, `odo_after`, `distance`, `liters`, `amount_spent`
2. **Summary** - สรุปค่าสถิติระยะทาง ปริมาณเชื้อเพลิง และอัตราสิ้นเปลือง รวมทั้งตารางรายวัน
   พร้อมกราฟแท่ง/เส้นแสดงลิตรและ km/L ต่อวัน
3. **Weekly** - ตาราง pivot สรุปลิตรเชื้อเพลิงในแต่ละวัน (จ.-อา.) ของสัปดาห์ ISO
